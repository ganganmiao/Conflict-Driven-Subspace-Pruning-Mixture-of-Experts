# 实验报告：标准多任务 MoE 的路由机制与泛化边界分析

**Subject:** Standard Mixture-of-Experts (Baseline) Performance Report
**Date:** 2025-09-16
**Experimental Focus:** 显式任务指令下的分工效率 vs. 零样本环境下的路由坍塌

---

## 1. 实验概述 (Executive Summary)

本实验旨在评估标准 MoE (Standard Mixture-of-Experts) 架构在异质多任务环境下的专家分工能力与鲁棒性。通过对比“训练态（含 ID）”与“盲测态（无 ID）”的路由热力图数据，我们发现 Baseline 模型虽然在有监督环境下能建立极高的分工效率，但在零样本推理中表现出灾难性的**静态模式坍塌 (Static Mode Collapse)**，证明其路由决策机制完全依赖于显式标签的线性映射，而非对图像内容的理解。

---

## 2. 实验数据量化表 (Quantitative Data Tables)

以下数据直接提取自实验过程中的路由快照（Routing Snapshots）。数值表示在该任务中，各专家被选中的概率（归一化后的平均 Gate 权重）。

### 表 1：训练态路由分布 (With Explicit Task ID)

**状态**：Epoch 9，输入包含正确的 Task ID。
**预期**：清晰的专家分工。

| Task (With ID) | E0 | E1 | E2 | E3 | E4 | E5 | E6 | E7 | **主要专家 (Top-1)** |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| **T0 (MNIST)** | 0.00 | 0.00 | 0.02 | 0.13 | **0.45** | 0.10 | 0.29 | 0.00 | **E4 (45%)** |
| **T1 (KMNIST)** | 0.01 | 0.01 | 0.03 | 0.17 | 0.21 | 0.19 | **0.38** | 0.01 | **E6 (38%)** |
| **T2 (FMNIST)** | 0.10 | 0.01 | **0.50** | 0.05 | 0.16 | 0.12 | 0.05 | 0.02 | **E2 (50%)** |

> **数据解读**：在 Task ID 的指导下，模型建立了明确的映射关系：T0  E4，T2  E2，T1  E6。专家 E2 几乎成为了 FMNIST 的专用专家。

### 表 2：盲测态路由分布 (Input Task ID = None)

**状态**：推理阶段，强制移除 Task ID（输入全零向量）。
**预期**：验证模型是否具备基于内容的零样本路由能力。

| Real Task (Truth) | E0 | E1 | E2 | E3 | E4 | E5 | E6 | E7 | **坍塌倾向** |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| **Real T0** | 0.01 | 0.00 | 0.05 | 0.10 | **0.38** | 0.09 | **0.37** | 0.00 | **E4 + E6** |
| **Real T1** | 0.01 | 0.00 | 0.09 | 0.12 | **0.33** | 0.13 | **0.32** | 0.00 | **E4 + E6** |
| **Real T2** | 0.01 | 0.00 | 0.12 | 0.15 | **0.27** | 0.20 | **0.26** | 0.00 | **E4 + E6** |

> **数据解读**：**严重坍塌**。无论输入图片是数字还是衣物，路由分布几乎完全一致（Pearson 相关系数接近 1.0）。T2 原本的专家 E2 被弃用（仅 0.12），所有任务都被盲目导向训练时的高频专家 E4 和 E6。

---

## 3. 实验结果分析 (Results Analysis)

### 3.1 训练态：高效但脆弱的“查表机制”

如表 1 所示，Baseline 模型在 Epoch 9 达到了极高的分工水平。

* **T2 (FMNIST)** 成功避开了处理文字的专家，独占了 **E2**。
* **T0 (MNIST)** 集中在 **E4**。
* 这种分工看似智能，实则脆弱。Router 实际上是在拟合 `Input_ID -> Expert_Index` 的强关联。由于 Task Embedding 是确定性的强信号，Router 仅需学习简单的线性偏置即可将 Loss 最小化，从而**绕过**了学习图像特征这一更困难的任务。

### 3.2 盲测态：静态模式坍塌 (Static Mode Collapse)

表 2 揭示了 Baseline 的真实面目。当移除了 ID 这一“拐杖”后：

1. **特征失明**：Router 对 Real T0 (简单线条) 和 Real T2 (复杂实物) 给出了几乎相同的专家分配方案。这证明 Router **完全未利用**图像内容的统计特征（如笔画密度、纹理）进行决策。
2. **偏置主导**：E4 和 E6 在盲测中的高占比（~30-40%）仅仅反映了它们在训练集中的高频激活偏置（Bias）。
3. **专家失效**：在有 ID 时表现优异的“衣服专家” E2，在无 ID 时未能识别出衣服图片，利用率跌至 12%。

---

## 4. 结论 (Conclusion)

本实验证实了标准 MoE 架构在多任务学习中的一个关键缺陷：**指令过拟合 (Instruction Overfitting)**。

* **Baseline 是一个优秀的“执行者”**：在指令（Task ID）明确时，它能高效调度资源，实现任务隔离。
* **Baseline 是一个失败的“决策者”**：它缺乏内省能力，无法在指令缺失的情况下通过观察数据本质来推断任务意图。
* **工程警示**：Baseline 架构不具备 Zero-Shot 泛化能力。若应用于标签可能丢失或含有噪声的真实场景，该系统将面临功能瘫痪的风险。